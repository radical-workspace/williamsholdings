(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[695],{1187:function(e,s,t){Promise.resolve().then(t.bind(t,6444))},6444:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return i}});var n=t(7437),r=t(2265),a=t(6474);function i(){let[e,s]=(0,r.useState)(null),[t,i]=(0,r.useState)(null),[c,l]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0),[h,u]=(0,r.useState)(null);async function m(){try{let e=(0,a.D)(),{data:{user:t},error:n}=await e.auth.getUser();if(n){u("User error: ".concat(n.message)),d(!1);return}if(s(t),t){let{data:s,error:n}=await e.from("profiles").select("*").eq("user_id",t.id).single();n?u("Profile error: ".concat(n.message)):i(s);let{data:r,error:a}=await e.from("accounts").select("*").eq("user_id",t.id).single();a?u("Account error: ".concat(a.message)):l(r)}}catch(e){u("Unexpected error: ".concat(e))}finally{d(!1)}}async function x(){if(e)try{var s;let t=(0,a.D)(),{error:n}=await t.from("profiles").insert({user_id:e.id,first_name:(null===(s=e.email)||void 0===s?void 0:s.split("@")[0])||"User"});n?u("Profile creation error: ".concat(n.message)):m()}catch(e){u("Profile creation failed: ".concat(e))}}async function f(){if(e)try{let s=(0,a.D)(),t="ACC"+Math.floor(1e9*Math.random()).toString().padStart(9,"0"),{error:n}=await s.from("accounts").insert({user_id:e.id,account_number:t,available_balance:1e3});n?u("Account creation error: ".concat(n.message)):m()}catch(e){u("Account creation failed: ".concat(e))}}return((0,r.useEffect)(()=>{m()},[]),o)?(0,n.jsx)("div",{className:"p-4",children:"Loading..."}):(0,n.jsxs)("div",{className:"p-4 space-y-4 max-w-2xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Authentication Debug"}),h&&(0,n.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:h}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"User Status"}),e?(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"User ID:"})," ",e.id]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,n.jsx)("p",{className:"text-green-600",children:"✅ Authenticated"})]}):(0,n.jsx)("p",{className:"text-red-600",children:"❌ Not authenticated"})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Profile Status"}),t?(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Profile ID:"})," ",t.id]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Name:"})," ",t.first_name]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"PIN Hash:"})," ",t.pin_hash?"✅ Set":"❌ Not set"]}),(0,n.jsx)("p",{className:"text-green-600",children:"✅ Profile exists"})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-yellow-600",children:"⚠️ Profile missing"}),e&&(0,n.jsx)("button",{onClick:x,className:"btn btn-primary mt-2",children:"Create Profile"})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Account Status"}),c?(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Account Number:"})," ",c.account_number]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Balance:"})," $",c.available_balance]}),(0,n.jsx)("p",{className:"text-green-600",children:"✅ Account exists"})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-yellow-600",children:"⚠️ Account missing"}),e&&(0,n.jsx)("button",{onClick:f,className:"btn btn-primary mt-2",children:"Create Account"})]})]}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Actions"}),(0,n.jsxs)("div",{className:"space-x-2",children:[(0,n.jsx)("button",{onClick:m,className:"btn btn-ghost",children:"Refresh Data"}),e&&(0,n.jsx)("a",{href:"/auth/pin-setup",className:"btn btn-primary",children:"Set PIN"}),!e&&(0,n.jsx)("a",{href:"/auth/sign-in",className:"btn btn-primary",children:"Sign In"})]})]})]})]})}},6474:function(e,s,t){"use strict";t.d(s,{D:function(){return i}});var n=t(9851),r=t(357);let a=null;function i(){var e;if(a)return a;let s="https://ciihrogqtiqhbwunqxja.supabase.co",t=null!==(e=r.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY)&&void 0!==e?e:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpaWhyb2dxdGlxaGJ3dW5xeGphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxODIyMzgsImV4cCI6MjA3MDc1ODIzOH0.o4o1p3P0a0Kwnmj3TpUNmOtQb2J_p_bV1vhCksc-TKo";if(!s||!t)throw Error("Supabase env vars missing.");return a=(0,n.createBrowserClient)(s,t)}}},function(e){e.O(0,[851,971,23,744],function(){return e(e.s=1187)}),_N_E=e.O()}]);