(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[774],{4114:function(e,t,i){Promise.resolve().then(i.bind(i,9804))},9804:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return c}});var s=i(7437),a=i(2265),r=i(6474),n=i(5683);function l(e){return n.createHash("sha256").update("salt"+e).digest("hex")}function c(){let[e,t]=(0,a.useState)(""),[i,n]=(0,a.useState)(""),[c,u]=(0,a.useState)(""),[d,o]=(0,a.useState)(!1);async function h(t){if(t.preventDefault(),e!==i){u("PINs do not match");return}if(!/^\d{6}$/.test(e)){u("PIN must be 6 digits");return}o(!0),u("Setting PIN...");try{var s;let t=(0,r.D)(),{data:{user:i},error:a}=await t.auth.getUser();if(a||!i){u("Authentication error: ".concat((null==a?void 0:a.message)||"Not signed in")),o(!1);return}u("User authenticated. Creating/updating profile...");let n=l(e),{data:c,error:d}=await t.from("profiles").insert({user_id:i.id,first_name:(null===(s=i.email)||void 0===s?void 0:s.split("@")[0])||"User",pin_hash:n}).select().single();if(d){if("23505"===d.code){u("Profile exists. Updating PIN...");let{data:e,error:s}=await t.from("profiles").update({pin_hash:n}).eq("user_id",i.id).select().single();if(s){u("Update error: ".concat(s.message)),o(!1);return}c=e}else{u("Profile error: ".concat(d.message)),o(!1);return}}u("PIN set successfully! Verifying..."),await new Promise(e=>setTimeout(e,500));let h=l(e);(null==c?void 0:c.pin_hash)===h?(u("✅ PIN verification successful! Redirecting to dashboard..."),localStorage.setItem("pin_verified","true"),localStorage.setItem("pin_verified_at",Date.now().toString()),setTimeout(()=>{window.location.href="/dashboard"},1500)):u("❌ PIN verification failed")}catch(e){u("Unexpected error: ".concat(e))}finally{o(!1)}}return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,s.jsxs)("div",{className:"w-full max-w-sm space-y-4 card",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-center",children:"Set your PIN (Client-Side)"}),(0,s.jsxs)("form",{onSubmit:h,className:"space-y-3",children:[(0,s.jsx)("input",{className:"input",inputMode:"numeric",maxLength:6,value:e,onChange:e=>t(e.target.value.replace(/\D/g,"")),placeholder:"6-digit PIN",required:!0}),(0,s.jsx)("input",{className:"input",inputMode:"numeric",maxLength:6,value:i,onChange:e=>n(e.target.value.replace(/\D/g,"")),placeholder:"Confirm PIN",required:!0}),c&&(0,s.jsx)("div",{className:"text-sm p-2 rounded ".concat(c.includes("✅")?"bg-green-100 text-green-700":c.includes("❌")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:c}),(0,s.jsx)("button",{className:"btn btn-primary w-full",disabled:d,children:d?"Setting PIN...":"Set PIN"})]}),(0,s.jsxs)("div",{className:"text-center space-y-2",children:[(0,s.jsx)("div",{className:"text-sm text-slate-600",children:"This uses client-side database access to bypass API issues"}),(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)("a",{href:"/auth/debug",className:"text-blue-600 underline text-sm",children:"Debug Page"}),(0,s.jsx)("a",{href:"/auth/test",className:"text-blue-600 underline text-sm",children:"Test Page"})]})]})]})})}},6474:function(e,t,i){"use strict";i.d(t,{D:function(){return n}});var s=i(9851),a=i(357);let r=null;function n(){var e;if(r)return r;let t="https://ciihrogqtiqhbwunqxja.supabase.co",i=null!==(e=a.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY)&&void 0!==e?e:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpaWhyb2dxdGlxaGJ3dW5xeGphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxODIyMzgsImV4cCI6MjA3MDc1ODIzOH0.o4o1p3P0a0Kwnmj3TpUNmOtQb2J_p_bV1vhCksc-TKo";if(!t||!i)throw Error("Supabase env vars missing.");return r=(0,s.createBrowserClient)(t,i)}}},function(e){e.O(0,[218,851,309,971,23,744],function(){return e(e.s=4114)}),_N_E=e.O()}]);