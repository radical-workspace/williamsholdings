(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{275:function(e,t,s){Promise.resolve().then(s.bind(s,3572))},3572:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var n=s(7437),i=s(2265),a=s(6474),r=s(5683);function l(){let[e,t]=(0,i.useState)("signin"),[s,l]=(0,i.useState)("test@williamsholdings.com"),[c,u]=(0,i.useState)("password123"),[d,o]=(0,i.useState)("123456"),[h,m]=(0,i.useState)("123456"),[p,g]=(0,i.useState)(""),[x,f]=(0,i.useState)(!1),[N,b]=(0,i.useState)(null);async function v(){try{let e=(0,a.D)(),{data:{user:s}}=await e.auth.getUser();if(b(s),s){g("Signed in as: ".concat(s.email));let{data:n}=await e.from("profiles").select("pin_hash").eq("user_id",s.id).single();(null==n?void 0:n.pin_hash)?(t("dashboard"),g("✅ Fully authenticated! PIN is set.")):(t("pinsetup"),g("Signed in, but PIN not set. Please set your PIN."))}else g("Not signed in. Please sign up or sign in."),t("signin")}catch(e){g("Auth check error: ".concat(e))}}async function I(){f(!0),g("Creating account...");try{let e=(0,a.D)(),{data:t,error:n}=await e.auth.signUp({email:s,password:c,options:{data:{first_name:"Test User"}}});n?g("Sign up error: ".concat(n.message)):(g("✅ Account created! Now signing in..."),await y())}catch(e){g("Error: ".concat(e))}finally{f(!1)}}async function y(){f(!0),g("Signing in...");try{let e=(0,a.D)(),{data:n,error:i}=await e.auth.signInWithPassword({email:s,password:c});if(i){g("Sign in error: ".concat(i.message)),f(!1);return}g("✅ Signed in! Checking profile..."),b(n.user),await new Promise(e=>setTimeout(e,1e3));let{data:r,error:l}=await e.from("profiles").select("pin_hash").eq("user_id",n.user.id).single();l&&"PGRST116"===l.code?(g("Profile not found. Moving to PIN setup..."),t("pinsetup")):(null==r?void 0:r.pin_hash)?(g("✅ Profile exists with PIN. Ready to go!"),t("dashboard")):(g("Profile exists but no PIN. Please set your PIN."),t("pinsetup"))}catch(e){g("Error: ".concat(e))}finally{f(!1)}}async function j(){if(d!==h){g("PINs do not match");return}if(!/^\d{6}$/.test(d)){g("PIN must be 6 digits");return}f(!0),g("Setting PIN...");try{var e;let s=(0,a.D)(),n=r.createHash("sha256").update("salt"+d).digest("hex"),{data:i,error:l}=await s.from("profiles").upsert({user_id:N.id,first_name:(null===(e=N.email)||void 0===e?void 0:e.split("@")[0])||"User",pin_hash:n},{onConflict:"user_id"}).select().single();if(l){g("Database error: ".concat(l.message,". \n\nSOLUTION: Go to Supabase Dashboard → SQL Editor → Run:\nALTER TABLE public.profiles DISABLE ROW LEVEL SECURITY;")),f(!1);return}g("✅ PIN set successfully!"),t("dashboard")}catch(e){g("Unexpected error: ".concat(e))}finally{f(!1)}}return((0,i.useEffect)(()=>{v()},[]),"signup"===e||"signin"===e)?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"w-full max-w-sm space-y-4 card",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-center",children:"signup"===e?"Create Account":"Sign In"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("input",{className:"input",placeholder:"Email",value:s,onChange:e=>l(e.target.value),type:"email",required:!0}),(0,n.jsx)("input",{className:"input",type:"password",placeholder:"Password",value:c,onChange:e=>u(e.target.value),required:!0}),p&&(0,n.jsx)("div",{className:"text-sm p-2 rounded ".concat(p.includes("✅")?"bg-green-100 text-green-700":p.includes("error")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:p}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("button",{onClick:"signup"===e?I:y,className:"btn btn-primary w-full",disabled:x,children:x?"Working...":"signup"===e?"Create Account":"Sign In"}),(0,n.jsx)("button",{onClick:()=>t("signup"===e?"signin":"signup"),className:"btn btn-ghost w-full",disabled:x,children:"signup"===e?"Already have account? Sign In":"Need account? Sign Up"})]})]}),(0,n.jsxs)("div",{className:"text-center space-y-2",children:[(0,n.jsx)("div",{className:"text-sm text-slate-600",children:"Using test credentials by default"}),(0,n.jsx)("a",{href:"/auth/debug",className:"text-blue-600 underline text-sm",children:"Debug Page"})]})]})}):"pinsetup"===e?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"w-full max-w-sm space-y-4 card",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-center",children:"Set Your PIN"}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"text-sm text-green-600 text-center",children:["✅ Signed in as: ",null==N?void 0:N.email]}),(0,n.jsx)("input",{className:"input",inputMode:"numeric",maxLength:6,value:d,onChange:e=>o(e.target.value.replace(/\D/g,"")),placeholder:"6-digit PIN",required:!0}),(0,n.jsx)("input",{className:"input",inputMode:"numeric",maxLength:6,value:h,onChange:e=>m(e.target.value.replace(/\D/g,"")),placeholder:"Confirm PIN",required:!0}),p&&(0,n.jsx)("div",{className:"text-sm p-2 rounded ".concat(p.includes("✅")?"bg-green-100 text-green-700":p.includes("error")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:p}),(0,n.jsx)("button",{onClick:j,className:"btn btn-primary w-full",disabled:x,children:x?"Setting PIN...":"Set PIN"})]})]})}):"dashboard"===e?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"w-full max-w-sm space-y-4 card",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-center",children:"✅ Authentication Complete!"}),(0,n.jsxs)("div",{className:"space-y-3 text-center",children:[(0,n.jsxs)("div",{className:"text-green-600",children:["Signed in as: ",null==N?void 0:N.email]}),(0,n.jsx)("div",{className:"text-green-600",children:"PIN is set and ready!"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("a",{href:"/dashboard",className:"btn btn-primary w-full block",children:"Go to Dashboard"}),(0,n.jsx)("button",{onClick:()=>{(0,a.D)().auth.signOut(),t("signin"),b(null),g("")},className:"btn btn-ghost w-full",children:"Sign Out"})]})]})]})}):null}},6474:function(e,t,s){"use strict";s.d(t,{D:function(){return r}});var n=s(9851),i=s(357);let a=null;function r(){var e,t;if(a)return a;let s=null!==(t=null!==(e=i.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY)&&void 0!==e?e:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpaWhyb2dxdGlxaGJ3dW5xeGphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxODIyMzgsImV4cCI6MjA3MDc1ODIzOH0.o4o1p3P0a0Kwnmj3TpUNmOtQb2J_p_bV1vhCksc-TKo")&&void 0!==t?t:"",r=e=>e.trim().replace(/^['"]+|['"]+$/g,""),l=r("https://ciihrogqtiqhbwunqxja.supabase.co"),c=r(s);if(!l||!c)throw Error("Supabase env vars missing.");return a=(0,n.createBrowserClient)(l,c)}}},function(e){e.O(0,[218,851,309,971,23,744],function(){return e(e.s=275)}),_N_E=e.O()}]);