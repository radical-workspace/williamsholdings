(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[140],{4226:function(e,s,a){Promise.resolve().then(a.bind(a,1695))},1695:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return l}});var r=a(7437),t=a(2265),i=a(6463),d=a(6474);function l(){let[e,s]=(0,t.useState)(!1),[a,l]=(0,t.useState)(""),n=(0,i.useRouter)(),c=(0,t.useCallback)(async()=>{let{data:{user:e}}=await (0,d.D)().auth.getUser();if(!e){n.push("/admin/login");return}},[n]);async function o(e){e.preventDefault(),s(!0),l("");let a=new FormData(e.currentTarget),r=a.get("email"),t=a.get("password"),i=a.get("firstName"),n=a.get("lastName");try{var c,o,m;if(null===(c=document.getElementById("create-server-side"))||void 0===c?void 0:c.checked){let a=null===(m=(await (0,d.D)().auth.getSession()).data)||void 0===m?void 0:null===(o=m.session)||void 0===o?void 0:o.access_token;if(!a)throw Error("No active session token");let c=await fetch("/api/admin/create",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify({email:r,password:t,firstName:i,lastName:n})}),x=await c.json();if(!c.ok)throw Error((null==x?void 0:x.error)||"Server create failed");l("Admin created server-side successfully"),e.target.reset(),s(!1);return}let{data:a,error:x}=await (0,d.D)().auth.signUp({email:r,password:t});if(x)throw x;if(a.user){let{error:s}=await (0,d.D)().from("profiles").insert({id:a.user.id,user_id:a.user.id,email:r,first_name:i,last_name:n,role:"admin"});if(s)throw s;l("Admin user created successfully!"),e.target.reset()}}catch(e){l("Error: ".concat(e.message))}finally{s(!1)}}async function m(e){e.preventDefault();let s=new FormData(e.currentTarget),a=s.get("email"),r=function(e,s,a,r){let t=e.replace(/'/g,"''"),i=a.replace(/'/g,"''"),d=r.replace(/'/g,"''"),l=s.replace(/'/g,"''");return"-- Run as project owner in Supabase SQL editor\n\nINSERT INTO auth.users (id, email, encrypted_password, email_confirmed_at, created_at, updated_at, raw_app_meta_data, raw_user_meta_data)\nVALUES (gen_random_uuid(), '".concat(t,"', crypt('").concat(l,"', gen_salt('bf')), now(), now(), now(), '{\"provider\":\"email\"}', '{}')\nON CONFLICT (email) DO NOTHING;\n\nINSERT INTO public.profiles (id, user_id, email, first_name, last_name, role, created_at)\nSELECT u.id, u.id, u.email, '").concat(i,"', '").concat(d,"', 'admin', now() FROM auth.users u WHERE u.email = '").concat(t,"'\nAND NOT EXISTS (SELECT 1 FROM public.profiles p WHERE p.user_id = u.id);\n")}(a,s.get("password"),s.get("firstName"),s.get("lastName"));await navigator.clipboard.writeText(r),l("Admin creation SQL copied to clipboard. Paste into Supabase SQL editor and run as project owner.")}async function x(e){s(!0),l("");try{switch(e){case"backup":l("Database backup initiated. This is a simulated action.");break;case"cleanup":let s=new Date;s.setDate(s.getDate()-30);let{error:a}=await (0,d.D)().from("transactions").delete().eq("status","failed").lt("created_at",s.toISOString());if(a)throw a;l("Cleaned up old failed transactions.");break;case"reset_demo":await (0,d.D)().from("transactions").delete().neq("id",""),await (0,d.D)().from("accounts").update({available_balance:1e3}).neq("id",""),l("Demo data reset completed.");break;default:l("Unknown action.")}}catch(e){l("Error: ".concat(e.message))}finally{s(!1)}}return(0,t.useEffect)(()=>{c()},[c]),(0,r.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,r.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("a",{href:"/admin/dashboard",className:"text-blue-600 hover:text-blue-800 mr-4",children:"← Dashboard"}),(0,r.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Admin Settings"})]})})})}),(0,r.jsxs)("main",{className:"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8",children:[a&&(0,r.jsx)("div",{className:"mb-6 p-4 rounded-md ".concat(a.includes("Error")?"bg-red-50 text-red-700 border border-red-200":"bg-green-50 text-green-700 border border-green-200"),children:a}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Create Admin User"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Add a new administrator to the system"})]}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("form",{onSubmit:o,className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),(0,r.jsx)("input",{type:"text",name:"firstName",required:!0,placeholder:"Enter first name",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),(0,r.jsx)("input",{type:"text",name:"lastName",required:!0,placeholder:"Enter last name",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,r.jsx)("input",{type:"email",name:"email",required:!0,placeholder:"admin@williamsholdings.com",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),(0,r.jsx)("input",{type:"password",name:"password",required:!0,minLength:6,placeholder:"Enter secure password",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,r.jsx)("button",{type:"submit",disabled:e,className:"w-full md:w-auto px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400",children:e?"Creating...":"Create Admin User"}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 mt-2",children:[(0,r.jsxs)("label",{className:"inline-flex items-center",children:[(0,r.jsx)("input",{id:"create-server-side",type:"checkbox",className:"form-checkbox h-4 w-4 text-blue-600"}),(0,r.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:"Create server-side (requires admin)"})]}),(0,r.jsx)("button",{type:"button",onClick:e=>m(e),className:"ml-auto px-4 py-2 bg-gray-100 text-gray-900 rounded-md hover:bg-gray-200",children:"Copy Admin SQL"})]})]})})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"System Maintenance"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Database and system maintenance operations"})]}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("button",{onClick:()=>x("backup"),disabled:e,className:"flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:bg-gray-100",children:[(0,r.jsx)("svg",{className:"h-8 w-8 text-blue-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"})}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Backup Database"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Create system backup"})]}),(0,r.jsxs)("button",{onClick:()=>x("cleanup"),disabled:e,className:"flex flex-col items-center p-4 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:bg-gray-100",children:[(0,r.jsx)("svg",{className:"h-8 w-8 text-green-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Cleanup Data"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Remove old failed transactions"})]}),(0,r.jsxs)("button",{onClick:()=>x("reset_demo"),disabled:e,className:"flex flex-col items-center p-4 border border-red-300 rounded-lg hover:bg-red-50 disabled:bg-gray-100",children:[(0,r.jsx)("svg",{className:"h-8 w-8 text-red-600 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),(0,r.jsx)("span",{className:"text-sm font-medium",children:"Reset Demo"}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:"Reset all demo data"})]})]})})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Database Schema"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"Current database tables and structure"})]}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"profiles"}),(0,r.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,r.jsx)("li",{children:"• id (uuid, primary key)"}),(0,r.jsx)("li",{children:"• user_id (uuid, foreign key)"}),(0,r.jsx)("li",{children:"• email (text)"}),(0,r.jsx)("li",{children:"• first_name (text)"}),(0,r.jsx)("li",{children:"• last_name (text)"}),(0,r.jsx)("li",{children:"• phone (text)"}),(0,r.jsx)("li",{children:"• role (text)"}),(0,r.jsx)("li",{children:"• created_at (timestamp)"})]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"accounts"}),(0,r.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,r.jsx)("li",{children:"• id (uuid, primary key)"}),(0,r.jsx)("li",{children:"• user_id (uuid, foreign key)"}),(0,r.jsx)("li",{children:"• account_number (text)"}),(0,r.jsx)("li",{children:"• available_balance (numeric)"}),(0,r.jsx)("li",{children:"• currency (text)"}),(0,r.jsx)("li",{children:"• status (text)"}),(0,r.jsx)("li",{children:"• created_at (timestamp)"})]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"transactions"}),(0,r.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,r.jsx)("li",{children:"• id (uuid, primary key)"}),(0,r.jsx)("li",{children:"• user_id (uuid, foreign key)"}),(0,r.jsx)("li",{children:"• type (text)"}),(0,r.jsx)("li",{children:"• amount (numeric)"}),(0,r.jsx)("li",{children:"• currency (text)"}),(0,r.jsx)("li",{children:"• status (text)"}),(0,r.jsx)("li",{children:"• description (text)"}),(0,r.jsx)("li",{children:"• created_at (timestamp)"})]})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"pin_codes"}),(0,r.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,r.jsx)("li",{children:"• id (uuid, primary key)"}),(0,r.jsx)("li",{children:"• user_id (uuid, foreign key)"}),(0,r.jsx)("li",{children:"• pin_hash (text)"}),(0,r.jsx)("li",{children:"• created_at (timestamp)"}),(0,r.jsx)("li",{children:"• updated_at (timestamp)"})]})]})]})})]}),(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"System Information"})}),(0,r.jsx)("div",{className:"p-6",children:(0,r.jsxs)("dl",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Application"}),(0,r.jsx)("dd",{className:"text-sm text-gray-900",children:"WilliamsHoldings Banking System"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Version"}),(0,r.jsx)("dd",{className:"text-sm text-gray-900",children:"1.0.0"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Framework"}),(0,r.jsx)("dd",{className:"text-sm text-gray-900",children:"Next.js 14.2.5"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Database"}),(0,r.jsx)("dd",{className:"text-sm text-gray-900",children:"Supabase PostgreSQL"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Authentication"}),(0,r.jsx)("dd",{className:"text-sm text-gray-900",children:"Supabase Auth"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("dt",{className:"text-sm font-medium text-gray-500",children:"Environment"}),(0,r.jsx)("dd",{className:"text-sm text-gray-900",children:"Development"})]})]})})]})]})]})]})}},6474:function(e,s,a){"use strict";a.d(s,{D:function(){return d}});var r=a(9851),t=a(357);let i=null;function d(){var e;if(i)return i;let s="https://ciihrogqtiqhbwunqxja.supabase.co",a=null!==(e=t.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY)&&void 0!==e?e:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpaWhyb2dxdGlxaGJ3dW5xeGphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxODIyMzgsImV4cCI6MjA3MDc1ODIzOH0.o4o1p3P0a0Kwnmj3TpUNmOtQb2J_p_bV1vhCksc-TKo";if(!s||!a)throw Error("Supabase env vars missing.");return i=(0,r.createBrowserClient)(s,a)}},6463:function(e,s,a){"use strict";var r=a(1169);a.o(r,"usePathname")&&a.d(s,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(s,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(s,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[851,971,23,744],function(){return e(e.s=4226)}),_N_E=e.O()}]);