(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{3346:function(e,t,a){Promise.resolve().then(a.bind(a,2573))},2573:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var s=a(7437),r=a(2265),n=a(6463),l=a(6474);function i(){let[e,t]=(0,r.useState)([]),[a,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(""),[o,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(!1),h=(0,n.useRouter)(),p=(0,r.useCallback)(async()=>{let{data:{user:e}}=await (0,l.D)().auth.getUser();if(!e){h.push("/admin/login");return}},[h]);async function f(){try{let{data:e,error:a}=await (0,l.D)().from("profiles").select("\n          *,\n          accounts (\n            id,\n            account_number,\n            available_balance,\n            currency,\n            status\n          )\n        ").order("created_at",{ascending:!1});if(a)throw a;t(e||[])}catch(e){console.error("Error loading users:",e)}finally{i(!1)}}async function b(e,t){try{let{error:a}=await (0,l.D)().from("profiles").update(t).eq("id",e);if(a)throw a;await f(),x(!1),u(null)}catch(e){console.error("Error updating user:",e),alert("Failed to update user")}}async function y(e){if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{await (0,l.D)().from("accounts").delete().eq("user_id",e);let{error:t}=await (0,l.D)().from("profiles").delete().eq("id",e);if(t)throw t;await f()}catch(e){console.error("Error deleting user:",e),alert("Failed to delete user")}}async function g(e){try{let t="WH"+Math.random().toString().substr(2,8),{error:a}=await (0,l.D)().from("accounts").insert({user_id:e,account_number:t,available_balance:0,currency:"USD",status:"active"});if(a)throw a;await f()}catch(e){console.error("Error creating account:",e),alert("Failed to create account")}}(0,r.useEffect)(()=>{p(),f()},[p]);let j=e.filter(e=>{var t,a;return e.email.toLowerCase().includes(c.toLowerCase())||(null===(t=e.first_name)||void 0===t?void 0:t.toLowerCase().includes(c.toLowerCase()))||(null===(a=e.last_name)||void 0===a?void 0:a.toLowerCase().includes(c.toLowerCase()))});return a?(0,s.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading users..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"flex justify-between items-center h-16",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("a",{href:"/admin/dashboard",className:"text-blue-600 hover:text-blue-800 mr-4",children:"← Dashboard"}),(0,s.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"User Management"})]})})})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("div",{className:"flex flex-col sm:flex-row gap-4",children:(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("input",{type:"text",placeholder:"Search users by name or email...",value:c,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})})})}),(0,s.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,s.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["Users (",j.length,")"]})}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Accounts"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.map(e=>{var t,a,r,n;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.first_name," ",e.last_name]}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:e.phone})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.email}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[(null===(t=e.accounts)||void 0===t?void 0:t.length)||0," account(s)",null===(a=e.accounts)||void 0===a?void 0:a.map(e=>(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[e.account_number," (",e.status,")"]},e.id))]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null===(r=e.accounts)||void 0===r?void 0:r.reduce((e,t)=>e+(Number(t.available_balance)||0),0))>0?(n=e.accounts.reduce((e,t)=>e+(Number(t.available_balance)||0),0),new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n)):"$0.00"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"bg-green-100 text-green-800"),children:e.role||"user"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{u(e),x(!0)},className:"text-blue-600 hover:text-blue-900",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>g(e.id),className:"text-green-600 hover:text-green-900",children:"+Account"}),(0,s.jsx)("button",{onClick:()=>y(e.id),className:"text-red-600 hover:text-red-900",children:"Delete"})]})})]},e.id)})})]})})]})]}),m&&o&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,s.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User"}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData(e.currentTarget);b(o.id,{first_name:t.get("first_name"),last_name:t.get("last_name"),phone:t.get("phone"),role:t.get("role")})},children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"First Name"}),(0,s.jsx)("input",{type:"text",name:"first_name",defaultValue:o.first_name,placeholder:"Enter first name",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Last Name"}),(0,s.jsx)("input",{type:"text",name:"last_name",defaultValue:o.last_name,placeholder:"Enter last name",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Phone"}),(0,s.jsx)("input",{type:"text",name:"phone",defaultValue:o.phone,placeholder:"Enter phone number",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),(0,s.jsxs)("select",{name:"role",defaultValue:o.role||"user",title:"Select user role",className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2",children:[(0,s.jsx)("option",{value:"user",children:"User"}),(0,s.jsx)("option",{value:"admin",children:"Admin"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{x(!1),u(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Save Changes"})]})]})]})})})]})}},6474:function(e,t,a){"use strict";a.d(t,{D:function(){return l}});var s=a(9851),r=a(357);let n=null;function l(){var e;if(n)return n;let t="https://ciihrogqtiqhbwunqxja.supabase.co",a=null!==(e=r.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY)&&void 0!==e?e:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpaWhyb2dxdGlxaGJ3dW5xeGphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxODIyMzgsImV4cCI6MjA3MDc1ODIzOH0.o4o1p3P0a0Kwnmj3TpUNmOtQb2J_p_bV1vhCksc-TKo";if(!t||!a)throw Error("Supabase env vars missing.");return n=(0,s.createBrowserClient)(t,a)}},6463:function(e,t,a){"use strict";var s=a(1169);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[851,971,23,744],function(){return e(e.s=3346)}),_N_E=e.O()}]);